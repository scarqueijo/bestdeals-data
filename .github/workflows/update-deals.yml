name: Atualizar Descontos Amazon ES (PA-API Oficial)

on:
  schedule:
    - cron: "*/15 * * * *"   # Atualiza a cada 15 minutos
  workflow_dispatch:

permissions:
  contents: write

jobs:
  fetch-deals:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Instalar Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Instalar dependÃªncias
        run: npm install amazon-paapi@1.0.7

      - name: Executar script de recolha
        run: node fetch-deals.js
        env:
          PAAPI_ACCESS_KEY: ${{ AKPAK4QL151762723824 }}
          PAAPI_SECRET_KEY: ${{ x2AFI7Z08/PlInoC4/2irL742O71Z2uo0YZ5HhgU }}
          PAAPI_PARTNER_TAG: ${{ descontoseopo-21 }}

      - name: Commit & Push resultados
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git pull --rebase origin main || true
          git add deals.json
          git commit -m "ðŸ¤– AtualizaÃ§Ã£o automÃ¡tica Amazon ES via PA-API" || true
          git push origin HEAD:main || true
